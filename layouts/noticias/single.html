{{ define "main" }}
<!-- Configuración PWA segura inyectada desde GitHub Secrets -->
<script>
{{- $vapidKey := getenv "VAPID_PUBLIC_KEY" -}}
window.PWA_SECURE_CONFIG = window.PWA_SECURE_CONFIG || {};
window.PWA_SECURE_CONFIG.environment = "{{ hugo.Environment }}";
window.PWA_SECURE_CONFIG.buildTime = {{ now.Unix }};
{{ if $vapidKey -}}
window.PWA_SECURE_CONFIG.vapidKey = "{{ $vapidKey }}";
window.PWA_SECURE_CONFIG.hasVapidFromEnv = true;
window.siteConfig = window.siteConfig || {};
window.siteConfig.vapidPublicKey = "{{ $vapidKey }}";
console.log('🔐 VAPID key cargada desde variable de entorno');
{{ else -}}
window.PWA_SECURE_CONFIG.hasVapidFromEnv = false;
// En desarrollo, cargar desde archivo local
fetch('/vapid-config.json')
  .then(response => response.ok ? response.json() : Promise.reject('No config'))
  .then(config => {
    if (config.publicKey) {
      window.siteConfig = window.siteConfig || {};
      window.siteConfig.vapidPublicKey = config.publicKey;
      console.log('🔧 VAPID key cargada desde configuración local');
    }
  })
  .catch(() => {
    console.log('🔧 Modo desarrollo - VAPID key no disponible');
  });
{{ end -}}
</script>

<!-- Script PWA Meta Injector -->
<script src="/js/pwa-meta-injector.js"></script>

<main class="main" role="main">
    <article class="post">
        
        <header class="post__header">
            <h1 class="post__title">{{ .Title }}</h1>
            {{ $format := "02-01-2006 15:04" }}
            <div>Publicado: {{ partial "fecha-es.html" .Date }}</div>
            <div>Autor: <a href="{{ .Params.AuthorLink }}">{{ .Params.Author }}</a></div>
        </header>
        
        <div class="content post__content clearfix">
            {{ .Content }}
        </div>
    </article>
</main>
{{ partial "authorbox.html" . }}
{{ partial "social-share.html" . }}

<!-- Script para funcionalidad de social share -->
{{ partial "social-share-script.html" . }}

{{ end }}
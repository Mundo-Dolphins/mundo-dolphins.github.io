# ---
# This workflow sends notifications to Telegram when a new article or podcast is published.
# Automatically detects new articles (content/noticias/*.md) or podcasts (data/season_*.json) 
# when deployed to production.
# Example messages sent:
# ğŸ“° Nuevo artÃ­culo publicado: Dolphins ganan el Super Bowl
# ğŸ”— https://mundodolphins.es/noticias/victoria-super-bowl/
#
# ğŸ™ï¸ Nuevo capÃ­tulo del podcast publicado: Dolphins Podcast Ep. 1
# ğŸ”— https://mundodolphins.es/podcast/episodio-1/
#
# Requires TELEGRAM_BOT_TOKEN and TELEGRAM_CHAT_ID secrets configured in the repository.
# ---

name: ğŸš€ Notify new articles or podcasts to Telegram

on:
  workflow_run:
    workflows: ["Deploy Hugo site to Pages"]
    types:
      - completed

concurrency:
  group: notify-articles-podcasts
  cancel-in-progress: false

jobs:
  notify-content:
    runs-on: ubuntu-latest
    if: ${{ github.event.workflow_run.conclusion == 'success' }}
    steps:
      - name: ğŸ”„ Checkout repository
        uses: actions/checkout@v6
        with:
          fetch-depth: 2

      - name: ï¿½ Detect and send new articles/podcasts to Telegram
        env:
          TELEGRAM_BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          TELEGRAM_CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          chmod +x scripts/notify/notify_articles_podcasts.sh
          ./scripts/notify/notify_articles_podcasts.sh